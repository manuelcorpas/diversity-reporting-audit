<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Diversity Reporting Audit | Results</title>
    <link rel="stylesheet" href="css/styles.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <header>
        <div class="header-content">
            <h1>Diversity Reporting Audit</h1>
            <p class="subtitle">Results from UK Cancer Genomics Publications</p>
            <p class="subtitle-secondary">UK Cancer Genomics Publications 2020-2025</p>
            <div class="header-meta">
                <span class="author">Dr Manuel Corpas</span>
                <span class="separator">|</span>
                <span class="affiliation">DSxHE Data Diversity Theme</span>
            </div>
        </div>
    </header>

    <main>
        <!-- Key Finding Banner -->
        <section class="scope-banner">
            <div class="scope-icon">&#128200;</div>
            <div class="scope-content">
                <strong>Key Finding</strong>
                <p>Only <strong>9.9%</strong> of UK cancer genomics publications explicitly report participant ancestry, ethnicity, or race. This systematic analysis of <strong>4,794 papers</strong> (2020-2025) reveals significant gaps in diversity reporting.</p>
            </div>
            <a href="https://github.com/manuelcorpas/diversity-reporting-audit" target="_blank" class="protocol-link">View Methods</a>
        </section>

        <!-- Research Question -->
        <section class="research-question">
            <div class="question-icon">?</div>
            <p id="research-question">Loading...</p>
        </section>

        <!-- Progress Tracker -->
        <section class="progress-section">
            <h2>Extraction Progress</h2>
            <div class="progress-container">
                <div class="progress-bar-wrapper">
                    <div class="progress-bar" id="progress-bar" style="width: 1%"></div>
                </div>
                <div class="progress-stats">
                    <span class="progress-text"><strong id="extracted-count">3</strong> of <strong id="total-sample">300</strong> papers extracted</span>
                    <span class="progress-percent" id="progress-percent">1%</span>
                </div>
            </div>
            <div class="progress-details">
                <div class="progress-detail">
                    <span class="detail-label">Search Results</span>
                    <span class="detail-value" id="search-results-count">3,427</span>
                </div>
                <div class="progress-detail">
                    <span class="detail-label">Sample Size</span>
                    <span class="detail-value">300 (stratified by year)</span>
                </div>
                <div class="progress-detail">
                    <span class="detail-label">Status</span>
                    <span class="detail-value status-active" id="extraction-status">In Progress</span>
                </div>
            </div>
        </section>

        <!-- Summary Cards -->
        <section class="summary-cards">
            <div class="card">
                <div class="card-icon">&#128218;</div>
                <div class="card-value" id="total-publications">3,427</div>
                <div class="card-label">Publications Found</div>
            </div>
            <div class="card">
                <div class="card-icon">&#9989;</div>
                <div class="card-value" id="gold-standard-rate">100%</div>
                <div class="card-label">Gold Standard Capture</div>
            </div>
            <div class="card" id="reporting-rate-card">
                <div class="card-icon">&#128202;</div>
                <div class="card-value" id="reporting-rate">--</div>
                <div class="card-label">Report Diversity</div>
                <div class="card-note">Pending extraction</div>
            </div>
            <div class="card">
                <div class="card-icon">&#128203;</div>
                <div class="card-value" id="extraction-progress">1%</div>
                <div class="card-label">Extraction Complete</div>
            </div>
        </section>

        <!-- Search Methodology -->
        <section class="methodology-section">
            <h2>Validated Search Methodology</h2>
            <div class="methodology-grid">
                <div class="method-card">
                    <h3>Database</h3>
                    <p id="search-database">PubMed/MEDLINE</p>
                </div>
                <div class="method-card">
                    <h3>Date Range</h3>
                    <p id="search-date-range">2020-01-01 to 2025-12-31</p>
                </div>
                <div class="method-card">
                    <h3>Search Executed</h3>
                    <p id="search-date-executed">2026-01-09</p>
                </div>
                <div class="method-card">
                    <h3>Total Results</h3>
                    <p id="search-total-results">3,427</p>
                </div>
            </div>

            <div class="search-string-container">
                <h3>Validated Search String <span class="badge success">Reproducible</span></h3>
                <pre id="search-string" class="search-string">Loading...</pre>
                <button class="copy-btn" onclick="copySearchString()">Copy to Clipboard</button>
            </div>

            <div class="validation-note">
                <strong>Validation Note:</strong> <span id="validation-note">Loading...</span>
            </div>
        </section>

        <!-- Gold Standard Papers -->
        <section class="gold-standard-section">
            <h2>Gold Standard Validation <span class="badge success">3/3 Captured</span></h2>
            <p class="section-description">Papers that must be captured by any valid search strategy</p>

            <div class="gold-standard-grid" id="gold-standard-grid">
                <!-- Populated by JavaScript -->
            </div>
        </section>

        <!-- Hypotheses -->
        <section class="hypotheses-section">
            <h2>Study Hypotheses</h2>
            <p class="section-description">To be tested upon extraction completion</p>
            <div class="hypotheses-grid" id="hypotheses-grid">
                <!-- Populated by JavaScript -->
            </div>
        </section>

        <!-- Results Section -->
        <section class="results-section">
            <h2>Results</h2>
            <div class="status-banner complete">
                <span class="status-icon">&#9989;</span>
                <div>
                    <strong>Analysis Complete</strong>
                    <p>Results based on <span id="current-extracted">4,794</span> UK cancer genomics papers (2020-2025) extracted from PubMed.</p>
                </div>
            </div>

            <!-- Filters -->
            <div class="filters-container">
                <h3>Filter Extracted Papers</h3>
                <div class="filters-grid">
                    <div class="filter-group">
                        <label for="filter-year">Year</label>
                        <select id="filter-year">
                            <option value="all">All Years</option>
                            <option value="2024">2024</option>
                            <option value="2025">2025</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label for="filter-cancer">Cancer Type</label>
                        <select id="filter-cancer">
                            <option value="all">All Types</option>
                            <option value="pan-cancer">Pan-cancer</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label for="filter-diversity">Diversity Reported</label>
                        <select id="filter-diversity">
                            <option value="all">All</option>
                            <option value="yes">Yes</option>
                            <option value="partial">Partial</option>
                            <option value="no">No</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <button class="export-btn" onclick="exportCSV()">Export CSV</button>
                    </div>
                </div>
            </div>

            <!-- Charts -->
            <div class="charts-grid">
                <div class="chart-container">
                    <h3>Reporting Rate by Year</h3>
                    <canvas id="chart-by-year"></canvas>
                    <p class="chart-note" id="chart-year-note">Based on 3 extracted papers</p>
                </div>
                <div class="chart-container">
                    <h3>Terminology Used</h3>
                    <canvas id="chart-terminology"></canvas>
                    <p class="chart-note" id="chart-term-note">Based on 3 extracted papers</p>
                </div>
            </div>

            <!-- Results Table -->
            <div class="results-table-container">
                <h3>Results by Cancer Type</h3>
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Cancer Type</th>
                            <th>Publications</th>
                            <th>Reporting Rate</th>
                            <th>Full Breakdown</th>
                        </tr>
                    </thead>
                    <tbody id="cancer-type-tbody">
                        <!-- Populated by JavaScript -->
                    </tbody>
                </table>
            </div>
        </section>

        <!-- Extracted Papers Detail -->
        <section class="extracted-section">
            <h2>Extracted Papers <span class="badge" id="extracted-badge">3 papers</span></h2>
            <p class="section-description">Detailed extraction data (filterable)</p>

            <table class="data-table" id="extracted-table">
                <thead>
                    <tr>
                        <th>PMID</th>
                        <th>Year</th>
                        <th>Journal</th>
                        <th>Cancer Type</th>
                        <th>N</th>
                        <th>Diversity Reported</th>
                        <th>Term Used</th>
                        <th>Full Breakdown</th>
                    </tr>
                </thead>
                <tbody id="extracted-tbody">
                    <!-- Populated by JavaScript -->
                </tbody>
            </table>
        </section>

        <!-- Key Findings -->
        <section class="findings-section">
            <h2>Key Findings</h2>
            <p class="section-description">Summary of diversity reporting patterns across 84 UK cancer genomics publications</p>
            <div class="findings-grid" id="findings-grid">
                <!-- Populated by JavaScript -->
            </div>
        </section>

        <!-- Methodology Note -->
        <section class="validation-section">
            <h2>Methodology</h2>
            <p class="section-description">Strict criteria: only explicit ancestry, ethnicity, or race terms</p>
            <div class="methodology-grid">
                <div class="method-card" style="border-left: 4px solid #10b981;">
                    <h3>Ancestry</h3>
                    <p>ancestry, ancestral, genetic ancestry, European/African/Asian ancestry</p>
                    <p><strong>248 papers</strong></p>
                </div>
                <div class="method-card" style="border-left: 4px solid #3b82f6;">
                    <h3>Race</h3>
                    <p>race, racial, Black, White, African American</p>
                    <p><strong>200 papers</strong></p>
                </div>
                <div class="method-card" style="border-left: 4px solid #8b5cf6;">
                    <h3>Ethnicity</h3>
                    <p>ethnicity, ethnic group, ethnic background</p>
                    <p><strong>26 papers</strong></p>
                </div>
                <div class="method-card" style="border-left: 4px solid #ef4444;">
                    <h3>Not Reported</h3>
                    <p>No diversity terms in abstract</p>
                    <p><strong>4,320 papers (90.1%)</strong></p>
                </div>
            </div>
            <p style="margin-top: 1rem; color: var(--text-secondary);">
                <strong>Excluded:</strong> Ambiguous terms like "population" (could mean study population), "diversity" (often molecular/tumor diversity), "demographic" (age/sex distribution).
            </p>
            <a href="data/validation_sample.csv" download class="export-btn" style="margin-top: 1rem;">Download Full Dataset CSV</a>
        </section>

        <!-- Sources -->
        <section class="sources-section">
            <h2>Data Sources</h2>
            <ul class="sources-list" id="sources-list">
                <!-- Populated by JavaScript -->
            </ul>
        </section>

        <!-- Citation -->
        <section class="citation-section">
            <h2>Cite This Protocol</h2>
            <div class="citation-box">
                <p>Corpas M. (2026). Diversity Reporting Audit: Study Protocol for UK Cancer Genomics Publications 2020-2025. DSxHE Data Diversity Theme / Cancer Research UK. Available at: https://manuelcorpas.github.io/diversity-reporting-audit/</p>
            </div>
        </section>
    </main>

    <footer>
        <p>DSxHE Data Diversity Theme | Cancer Research UK | Last updated: <span id="last-updated">2026-01-09</span></p>
    </footer>

    <script src="js/app.js"></script>
</body>
</html>
